<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cidadão Alerta - Demonstração</title>
    <link rel="stylesheet" href="/styles.css">
</head>

<body>

    <h1>Cidadão Alerta</h1>

    <!-- Formulário para novo incidente -->
    <div id="form-incidente-container">
        <form id="form-incidente">
            <input type="text" id="titulo" placeholder="Título do incidente" required />
            <textarea id="descricao" placeholder="Descrição detalhada" required></textarea>
            <input type="url" id="fotoURL" placeholder="URL da imagem (opcional)" />
            <button type="submit">Registrar Incidente</button>
        </form>
    </div>
    <!-- Container dos incidentes -->
    <div id="incidentes-container"></div>

    <script>
        // Inicializar localStorage
        function initStorage() {
            if (!localStorage.getItem('incidentes')) {
                localStorage.setItem('incidentes', JSON.stringify([]));
            }
        }

        // Obter incidentes
        function getIncidentes() {
            return JSON.parse(localStorage.getItem('incidentes'));
        }

        // Adicionar incidente
        function adicionarIncidente(titulo, descricao, fotoURL) {
            const incidentes = getIncidentes();
            incidentes.push({
                titulo,
                descricao,
                fotoURL,
                data: new Date().toLocaleString(),
                comentarios: []
            });
            localStorage.setItem('incidentes', JSON.stringify(incidentes));
            renderIncidentes();
        }

        // Adicionar comentário por índice
        function adicionarComentario(index, texto) {
            const incidentes = getIncidentes();
            incidentes[index].comentarios.push({
                texto,
                data: new Date().toLocaleString()
            });
            localStorage.setItem('incidentes', JSON.stringify(incidentes));
            renderIncidentes();
        }

        // Renderizar incidentes
        function renderIncidentes() {
            const container = document.getElementById('incidentes-container');
            container.innerHTML = '';
            const incidentes = getIncidentes();

            incidentes.forEach((incidente, index) => {
                const div = document.createElement('div');
                div.className = 'card-incidente';
                div.innerHTML = `
          <h3>${incidente.titulo}</h3>
          <p>${incidente.descricao}</p>
          ${incidente.fotoURL ? `<img src="${incidente.fotoURL}" alt="Imagem do incidente">` : ''}
          <small>Publicado em: ${incidente.data}</small>

          <h4>Comentários</h4>
          <ul>
            ${incidente.comentarios.map(c => `<li>${c.texto}<br><small>${c.data}</small></li>`).join('')}
          </ul>

          <form onsubmit="handleComentario(event, ${index})">
            <input type="text" name="comentario" placeholder="Escreva um comentário" required />
            <button type="submit">Comentar</button>
          </form>
        `;
                container.appendChild(div);
            });
        }

        // Enviar comentário
        function handleComentario(e, index) {
            e.preventDefault();
            const texto = e.target.comentario.value.trim();
            if (texto) {
                adicionarComentario(index, texto);
            }
            e.target.reset();
        }

        // Ao carregar a página
        document.addEventListener('DOMContentLoaded', () => {
            initStorage();
            renderIncidentes();
        });

        // Formulário de incidente
        document.getElementById('form-incidente').addEventListener('submit', e => {
            e.preventDefault();
            const titulo = document.getElementById('titulo').value;
            const descricao = document.getElementById('descricao').value;
            const fotoURL = document.getElementById('fotoURL').value;
            adicionarIncidente(titulo, descricao, fotoURL);
            e.target.reset();
        });
    </script>

</body>

</html>